---
title: "Compulsory Exercise 2: Prediction of Alzheimers Disease from Longitudinal MRI Data"
author:
- Chester Henry Charlton
- Kasper Eikeland
- Tinus Garshol
date: "`r format(Sys.time(), '%d %B, %Y')`"
header-includes: \usepackage{amsmath}
output:
  html_document:
  #   toc: no
  #   toc_depth: '2'
  #   df_print: paged
  #pdf_document:
    toc: no
    toc_depth: '2'
urlcolor: blue
abstract: "This is the place for your abstract (max 350 words)"
---

```{r setup, include=FALSE}
library("knitr")
knitr::opts_chunk$set(echo = TRUE,tidy=TRUE,message=FALSE,warning=FALSE,strip.white=TRUE,prompt=FALSE,
                      cache=TRUE, size="scriptsize",fig.width=4, fig.height=3,fig.align = "center")

```

```{r,eval=TRUE,echo=FALSE}
library("rmarkdown")
library("dplyr")
library("GGally")
library("tidyr")
library("formatR")
```

```{r}
setwd("/Users/chcharlton/NTNU/statLearning/compulsory_alzheimers")
# setwd("/Users/kaspe/Documents/NTNU/23V/TMA4268_Statistical_Learning/Projects/tma4268_alzheimers")
```


```{r}
longitudinal.df <- read.csv("oasis_longitudinal.csv")
cross_sectional.df <- read.csv("oasis_cross-sectional.csv")

alzheimers.df <- read.csv("oasis_longitudinal.csv")
alzheimers.df$Group <-as.factor(alzheimers.df$Group)
alzheimers.df.working <- alzheimers.df[,-c(2,)]
tail(alzheimers.df,30)
```

<!--  Henry's initial work here -->
NB: here is the link to the article describing this data in detail: https://direct.mit.edu/jocn/article/22/12/2677/4983/Open-Access-Series-of-Imaging-Studies-Longitudinal
how about adding some CV plots, Cp, BIC, something like that.

```{r}
# select some quantitative data and plot the pairs of it
pairwise_scatter_data <- alzheimers.df[,c("Age", "EDUC", "MMSE",
                                   "eTIV", "nWBV", "ASF")]
ggpairs(data=pairwise_scatter_data)
```
```{r}
# make some box plots on CDR
par(mfrow=c(2,4))  
boxplot(Age~CDR,data=alzheimers.df)
boxplot(EDUC~CDR,data=alzheimers.df)
boxplot(SES~CDR,data=alzheimers.df)
boxplot(MMSE~CDR,data=alzheimers.df)
boxplot(eTIV~CDR,data=alzheimers.df)
boxplot(nWBV~CDR,data=alzheimers.df)
boxplot(ASF~CDR,data=alzheimers.df)

# make some box plots on Group
par(mfrow=c(2,3))   
boxplot(Age~Group,data=alzheimers.df)
boxplot(EDUC~Group,data=alzheimers.df)
boxplot(MMSE~Group,data=alzheimers.df)
boxplot(eTIV~Group,data=alzheimers.df)
boxplot(nWBV~Group,data=alzheimers.df)
boxplot(ASF~Group,data=alzheimers.df)

```







<!--  Kasper's initial work here. -->
```{r}
cross_sectional.df <- read.csv("oasis_cross-sectional.csv")

# Patient is demented if CDR is > 0
cs_mutated <- cross_sectional.df %>%
  select(c(M.F, eTIV, nWBV, ASF, Age, CDR)) %>%
  na.omit() %>%
  mutate(Demented = as.factor(CDR>0),
         M.F = as.factor(M.F))

longitudinal.df <- read.csv("oasis_longitudinal.csv")

longitudinal_deltas <- longitudinal.df %>%
  group_by(Subject.ID) %>%
  summarise(dMMSE = last(MMSE) - first(MMSE),
            deTIV = last(eTIV) - first(eTIV),
            dnWBV = last(nWBV) - first(nWBV),
            dASF = last(ASF) - first(ASF),
            dAge = last(Age) - first(Age))

baseline_with_deltas <- longitudinal.df %>%
  filter(Visit == 1) %>%
  left_join(longitudinal_deltas, by = c("Subject.ID")) %>%
  mutate(Demented = as.factor(Group != "Nondemented"), # Those who converted became demented
         M.F = as.factor(M.F)) %>%
  select(-c(Subject.ID, MRI.ID, Group, Visit, MR.Delay, Hand, CDR, SES))

# cross-sectional data
ggpairs(cs_mutated)

# longitudinal data
ggpairs(baseline_with_deltas)
```

```{r}
library("tree")
library("gbm")
library("randomForest")

set.seed(1337)
# Longitudinal data
train <- sample(1:nrow(baseline_with_deltas), floor(.75 * nrow(baseline_with_deltas)))
longitudinal.train <- na.omit(baseline_with_deltas[train,])
longitudinal.test <- na.omit(baseline_with_deltas[-train,])
```


```{r}
# Classification tree
longitudinal.tree <- tree(Demented ~., longitudinal.train)
summary(longitudinal.tree)
plot(longitudinal.tree)
text(longitudinal.tree, pretty = 0)

# Test predictions
pred.tree <- predict(longitudinal.tree, newdata=longitudinal.test, type = "class")
table(pred.tree, longitudinal.test$Demented) # 0.7837838
# Pruning?
```


```{r}
# Bagging
longitudinal.bag <- randomForest(Demented ~., longitudinal.train, mtry = 12, importance = TRUE)
summary(longitudinal.bag)
plot(longitudinal.bag)
yhat.bag <- predict(longitudinal.bag, newdata = longitudinal.test, type = "class")
table(yhat.bag, longitudinal.test$Demented) # 0.8648649
```


```{r}
# Random forest
longitudinal.rf <- randomForest(Demented ~., longitudinal.train, importance = TRUE)
summary(longitudinal.rf)
plot(longitudinal.rf)
yhat.rf <- predict(longitudinal.rf, newdata = longitudinal.test, type = "class")
table(yhat.rf, longitudinal.test$Demented) # 0.8108108
```


```{r}
# Boosting
longitudinal.train.boost <- mutate(longitudinal.train, Demented = ifelse(Demented == "FALSE", 0,1))
longitudinal.boost <- gbm(Demented ~., data = longitudinal.train.boost,
                          distribution = "bernoulli", n.trees = 1000, interaction.depth = 2)
summary(longitudinal.boost)
longitudinal.test.boost <- mutate(longitudinal.test, Demented = ifelse(Demented == "FALSE", 0,1))
yhat.boost <- predict(longitudinal.boost, newdata = longitudinal.test.boost, n.trees = 1000, type = "response")
yhat.boost <- ifelse(yhat.boost > 0.5, 1,0)
table(yhat.boost, longitudinal.test.boost$Demented)
```


```{r}
# Logistic


```


```{r}
# SVM

```


```{r}
# LDA


```


```{r}
# QDA


```


```{r}
# KNN


```


<!--  Tinus' initial work here. -->


## Introduction: Scope and purpose of your project


## Descriptive data analysis/statistics
### Description of Data Types:
Group: The group that the patient was classified in at the across the various scans. Possible values are "Undemented," denoting a patient without symptoms of dementia throughout all scans, "Demented" denoting a patient with symptoms of dementia accross all scans, or "Converted," denoting someone who began without symptoms of dementia but developed them at a further scan.
Visit: The order of the visit in which the scan was done, indexed from 1.
MR Delay: The number of days since the previous scan. Marked as 0 for the initial scan.
M.F: Categorical variable for male or female patients at birth. M denotes male, F denotes female.
Hand: The patient's dominant hand. All of the patients were right-handed.
EDUC: The education level of the patient, measured in years (including elementary school).
SES: "Socioeconomic status as assessed by the Hollingshead Index of Social Position and classified into categories from 1 (highest status) to 5 (lowest status) (Hollingshead, 1957)"
MMSE: "Mini-Mental State Examination score (range is from 0 = worst to 30 = best) (Folstein, Folstein, & McHugh, 1975)"
CDR: "Clinical Dementia Rating (0 = no dementia, 0.5 = very mild AD, 1 = mild AD, 2 = moderate AD) (Morris, 1993)"
ASF: "Atlas scaling factor (unitless). Computed scaling factor that transforms native-space brain and skull to the atlas target (i.e., the determinant of the transform matrix) (Buckner et al., 2004)"
eTIV: "Estimated total intracranial volume (cm3) (Buckner et al., 2004)"
nWBV: "Normalized whole-brain volume, expressed as a percent of all voxels in the atlas-masked image that are labeled as gray or white matter by the automated tissue segmentation process (Fotenos et al., 2005)"



## Methods


## Results and interpretation


## Summary
